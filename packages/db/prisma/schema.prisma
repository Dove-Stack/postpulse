generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Organization {
  id               String          @id @default(cuid())
  clerkOrgId       String          @unique
  name             String
  slug             String          @unique
  stripeCustomerId String?         @unique
  plan             Plan            @default(FREE)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  posts            Post[]
  socialAccounts   SocialAccount[]
  users            User[]

  @@map("organizations")
}

model User {
  id        String        @id @default(cuid())
  clerkId   String        @unique
  email     String        @unique
  firstName String?
  lastName  String?
  imageUrl  String?
  role      Role          @default(MEMBER)
  orgId     String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  org       Organization? @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@index([orgId])
  @@map("users")
}

model Post {
  id          String       @id @default(cuid())
  content     String
  mediaUrls   String[]
  platforms   Platform[]
  status      PostStatus   @default(SCHEDULED)
  scheduledAt DateTime
  publishedAt DateTime?
  orgId       String
  views       Int          @default(0)
  likes       Int          @default(0)
  shares      Int          @default(0)
  comments    Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  org         Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@index([orgId, scheduledAt])
  @@index([status, scheduledAt])
  @@map("posts")
}

model SocialAccount {
  id           String       @id @default(cuid())
  platform     Platform
  accountName  String
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?
  orgId        String
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  org          Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([orgId, platform, accountName])
  @@index([orgId])
  @@map("social_accounts")
}

enum Plan {
  FREE
  PRO
  ENTERPRISE
}

enum Role {
  OWNER
  ADMIN
  MEMBER
}

enum Platform {
  TWITTER
  LINKEDIN
  FACEBOOK
  INSTAGRAM
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  FAILED
}
